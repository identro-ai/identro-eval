<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Identro-Eval Test Report</title>
    
    <!-- React and ReactDOM from CDN -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    
    <!-- Babel for JSX transformation -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <style>
        * {
            box-sizing: border-box;
        }
        
        body {
            margin: 0;
            padding: 20px;
            background: #FAFBFC;
            font-family: -apple-system, BlinkMacSystemFont, 'Inter', system-ui, sans-serif;
        }
        
        .filter-container {
            max-width: 1400px;
            margin: 0 auto 24px;
            background: white;
            border: 1px solid #E4E7EB;
            border-radius: 12px;
            padding: 20px;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.04);
        }
        
        .filter-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 16px;
        }
        
        .filter-group {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }
        
        .filter-label {
            font-size: 12px;
            font-weight: 600;
            color: #6B7280;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        
        .filter-select {
            padding: 8px 12px;
            border: 1px solid #E4E7EB;
            border-radius: 6px;
            background: white;
            font-size: 14px;
            color: #374151;
            cursor: pointer;
        }
        
        .filter-select:focus {
            outline: none;
            border-color: #3B82F6;
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
        }
        
        .report-header {
            text-align: center;
            margin-bottom: 40px;
        }
        
        .report-title {
            font-size: 32px;
            font-weight: 700;
            color: #1A1F36;
            margin-bottom: 8px;
        }
        
        .report-subtitle {
            font-size: 16px;
            color: #6B7280;
            margin-bottom: 16px;
        }
        
        .report-meta {
            display: flex;
            justify-content: center;
            gap: 12px;
            flex-wrap: wrap;
            margin-top: 16px;
        }
        
        .meta-badge {
            display: inline-flex;
            align-items: center;
            gap: 6px;
            background: white;
            padding: 8px 16px;
            border: 1px solid #E4E7EB;
            border-radius: 8px;
            font-size: 13px;
            color: #374151;
        }
        
        .meta-label {
            color: #6B7280;
            font-weight: 500;
        }
        
        .meta-value {
            font-weight: 600;
            color: #1A1F36;
        }
        
        .summary-cards {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 16px;
            margin-bottom: 32px;
            max-width: 1400px;
            margin-left: auto;
            margin-right: auto;
        }
        
        .summary-card {
            background: white;
            border: 1px solid #E4E7EB;
            border-radius: 12px;
            padding: 20px;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.04);
        }
        
        .summary-card-label {
            font-size: 12px;
            color: #6B7280;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-bottom: 8px;
        }
        
        .summary-card-value {
            font-size: 28px;
            font-weight: 700;
            color: #1A1F36;
        }
        
        .summary-card.passed .summary-card-value {
            color: #059669;
        }
        
        .summary-card.failed .summary-card-value {
            color: #DC2626;
        }
        
        @media (max-width: 768px) {
            body {
                padding: 12px;
            }
            
            .report-title {
                font-size: 24px;
            }
            
            .summary-cards {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="report-header">
        <h1 class="report-title">Identro-Eval Test Report</h1>
        <p class="report-subtitle">Automated AI Agent Quality Evaluation</p>
        <div class="report-meta" id="report-meta">
            <span class="meta-badge">
                <span class="meta-label">Generated:</span>
                <span class="meta-value" id="timestamp">-</span>
            </span>
            <span class="meta-badge">
                <span class="meta-label">Project:</span>
                <span class="meta-value" id="project-name">-</span>
            </span>
        </div>
    </div>
    
    <div id="summary-container"></div>
    <div id="filter-container"></div>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useRef, useEffect } = React;
        
        const TestCarousel = ({ tests: allTests }) => {
          const [currentTestIndex, setCurrentTestIndex] = useState(0);
          const [cardWidth, setCardWidth] = useState(0);
          const [criteriaCardWidth, setCriteriaCardWidth] = useState(0);
          const containerRef = useRef(null);
          
          // Filter states
          const [filterAgent, setFilterAgent] = useState('all');
          const [filterDimension, setFilterDimension] = useState('all');
          const [filterResult, setFilterResult] = useState('all');
          
          // View mode: 'carousel' or 'grid'
          const [viewMode, setViewMode] = useState('carousel');
          
          // Apply filters
          const tests = allTests.filter(test => {
            if (filterAgent !== 'all' && test.agentName !== filterAgent) return false;
            if (filterDimension !== 'all' && test.dimension !== filterDimension) return false;
            if (filterResult === 'passed' && !test.passed) return false;
            if (filterResult === 'failed' && test.passed) return false;
            return true;
          });
          
          // Independent criteria indices for each test (keyed by test index in filtered array)
          const [criteriaIndices, setCriteriaIndices] = useState({});
          
          const getCurrentCriteriaIndex = (testIdx) => {
            return criteriaIndices[testIdx] || 0;
          };
          
          const setCurrentCriteriaIndex = (testIdx, criteriaIdx) => {
            setCriteriaIndices(prev => ({
              ...prev,
              [testIdx]: criteriaIdx
            }));
          };
          
          // Reset test index if out of bounds after filtering
          useEffect(() => {
            if (currentTestIndex >= tests.length && tests.length > 0) {
              setCurrentTestIndex(0);
            }
          }, [tests.length]);
          
          // Get unique values for filters
          const uniqueAgents = [...new Set(allTests.map(t => t.agentName))].sort();
          const uniqueDimensions = [...new Set(allTests.map(t => t.dimension))].sort();
          
          const currentTest = tests[currentTestIndex];
          const currentCriteriaIndex = criteriaIndices[currentTestIndex];
          
          useEffect(() => {
            const updateDimensions = () => {
              if (containerRef.current) {
                const containerWidth = containerRef.current.offsetWidth;
                // Make cards 50% width to show 2 cards at once
                setCardWidth((containerWidth - 104) / 2); // 80px padding + 24px gap
                setCriteriaCardWidth((containerWidth - 144) / 2);
              }
            };
            
            updateDimensions();
            window.addEventListener('resize', updateDimensions);
            return () => window.removeEventListener('resize', updateDimensions);
          }, []);
          
          const navigateTest = (direction) => {
            const newIndex = Math.max(0, Math.min(tests.length - 1, currentTestIndex + direction));
            setCurrentTestIndex(newIndex);
          };
          
          const goToTest = (index) => {
            setCurrentTestIndex(index);
          };
          
          const navigateCriteria = (direction) => {
            const criteria = getCriteria(currentTest);
            if (!criteria || criteria.length === 0) return;
            const maxIndex = criteria.length - 1;
            const newIndices = [...criteriaIndices];
            newIndices[currentTestIndex] = Math.max(0, Math.min(maxIndex, currentCriteriaIndex + direction));
            setCriteriaIndices(newIndices);
          };
          
          const goToCriterion = (index) => {
            const newIndices = [...criteriaIndices];
            newIndices[currentTestIndex] = index;
            setCriteriaIndices(newIndices);
          };
          
          const getCriteria = (test) => {
            return test.evaluation?.reasoning?.criterionAnalysis || [];
          };
          
          const getScoreColor = (score) => {
            if (score >= 90) return '#059669';
            if (score >= 75) return '#D97706';
            return '#DC2626';
          };
          
          const getScoreBarClass = (score) => {
            if (score >= 90) return '#10B981';
            if (score >= 75) return '#F59E0B';
            return '#EF4444';
          };
          
          const getDimensionIcon = (dimension) => {
            const icons = {
              safety: 'ðŸ›¡ï¸',
              accuracy: 'ðŸŽ¯',
              consistency: 'ðŸ”„',
              relevance: 'ðŸ”',
              performance: 'âš¡',
              completeness: 'âœ…',
              format: 'ðŸ“‹',
              privacy: 'ðŸ”’',
              compliance: 'âš–ï¸',
              'brand-voice': 'ðŸŽ¨',
              'bias-fairness': 'âš–ï¸',
              'instruction-following': 'ðŸ“',
              schema: 'ðŸ“'
            };
            return icons[dimension?.toLowerCase()] || 'â„¹ï¸';
          };
          
          const ChevronLeft = () => (
            <svg style={{ width: '20px', height: '20px' }} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
              <polyline points="15 18 9 12 15 6"/>
            </svg>
          );
          
          const ChevronRight = () => (
            <svg style={{ width: '20px', height: '20px' }} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
              <polyline points="9 18 15 12 9 6"/>
            </svg>
          );
          
          if (!allTests || allTests.length === 0) {
            return (
              <div style={{ textAlign: 'center', padding: '40px', color: '#6B7280' }}>
                No test results available
              </div>
            );
          }
          
          return (
            <>
              {/* Filter Component */}
              <div style={{
                maxWidth: '1400px',
                margin: '0 auto 24px',
                background: 'white',
                border: '1px solid #E4E7EB',
                borderRadius: '12px',
                padding: '20px',
                boxShadow: '0 1px 3px rgba(0, 0, 0, 0.04)'
              }}>
                <div style={{
                  display: 'grid',
                  gridTemplateColumns: 'repeat(auto-fit, minmax(200px, 1fr))',
                  gap: '16px',
                  alignItems: 'end'
                }}>
                  <div style={{ display: 'flex', flexDirection: 'column', gap: '8px' }}>
                    <label style={{
                      fontSize: '12px',
                      fontWeight: '600',
                      color: '#6B7280',
                      textTransform: 'uppercase',
                      letterSpacing: '0.5px'
                    }}>
                      Agent / Team
                    </label>
                    <select 
                      value={filterAgent} 
                      onChange={(e) => setFilterAgent(e.target.value)}
                      style={{
                        padding: '10px 12px',
                        border: '1px solid #E4E7EB',
                        borderRadius: '6px',
                        background: 'white',
                        fontSize: '14px',
                        color: '#374151',
                        cursor: 'pointer'
                      }}
                    >
                      <option value="all">All ({uniqueAgents.length})</option>
                      {uniqueAgents.map(agent => (
                        <option key={agent} value={agent}>{agent}</option>
                      ))}
                    </select>
                  </div>
                  
                  <div style={{ display: 'flex', flexDirection: 'column', gap: '8px' }}>
                    <label style={{
                      fontSize: '12px',
                      fontWeight: '600',
                      color: '#6B7280',
                      textTransform: 'uppercase',
                      letterSpacing: '0.5px'
                    }}>
                      Dimension
                    </label>
                    <select 
                      value={filterDimension} 
                      onChange={(e) => setFilterDimension(e.target.value)}
                      style={{
                        padding: '10px 12px',
                        border: '1px solid #E4E7EB',
                        borderRadius: '6px',
                        background: 'white',
                        fontSize: '14px',
                        color: '#374151',
                        cursor: 'pointer'
                      }}
                    >
                      <option value="all">All ({uniqueDimensions.length})</option>
                      {uniqueDimensions.map(dim => (
                        <option key={dim} value={dim}>
                          {dim.charAt(0).toUpperCase() + dim.slice(1)}
                        </option>
                      ))}
                    </select>
                  </div>
                  
                  <div style={{ display: 'flex', flexDirection: 'column', gap: '8px' }}>
                    <label style={{
                      fontSize: '12px',
                      fontWeight: '600',
                      color: '#6B7280',
                      textTransform: 'uppercase',
                      letterSpacing: '0.5px'
                    }}>
                      Result
                    </label>
                    <select 
                      value={filterResult} 
                      onChange={(e) => setFilterResult(e.target.value)}
                      style={{
                        padding: '10px 12px',
                        border: '1px solid #E4E7EB',
                        borderRadius: '6px',
                        background: 'white',
                        fontSize: '14px',
                        color: '#374151',
                        cursor: 'pointer'
                      }}
                    >
                      <option value="all">All Results</option>
                      <option value="passed">âœ“ Passed Only</option>
                      <option value="failed">âœ— Failed Only</option>
                    </select>
                  </div>
                  
                  {/* View Mode - Hidden for now, will be implemented later
                  <div style={{ display: 'none', flexDirection: 'column', gap: '8px' }}>
                    <label>View Mode</label>
                    <div>...</div>
                  </div>
                  */}
                  
                  <div style={{ display: 'flex', flexDirection: 'column', gap: '8px' }}>
                    <label style={{
                      fontSize: '12px',
                      fontWeight: '600',
                      color: '#6B7280',
                      textTransform: 'uppercase',
                      letterSpacing: '0.5px'
                    }}>
                      Showing
                    </label>
                    <div style={{
                      padding: '10px',
                      background: '#F9FAFB',
                      border: '1px solid #E4E7EB',
                      borderRadius: '6px',
                      fontSize: '13px',
                      color: '#6B7280',
                      textAlign: 'center'
                    }}>
                      <strong>{tests.length}</strong> of {allTests.length} tests
                    </div>
                  </div>
                </div>
              </div>
              
              <div style={{
                  maxWidth: '1400px',
                  margin: '0 auto',
                  fontFamily: '-apple-system, BlinkMacSystemFont, "Inter", system-ui, sans-serif'
                }}>
                <div style={{ position: 'relative', padding: '0 60px' }}>
                  <div ref={containerRef} style={{ overflow: 'hidden', borderRadius: '16px' }}>
                    <div style={{ overflow: 'hidden', margin: '0 -20px', padding: '0 20px' }}>
                      <div style={{
                        display: 'flex',
                        gap: '24px',
                        transform: `translateX(-${currentTestIndex * (cardWidth + 24)}px)`,
                        transition: 'transform 0.5s cubic-bezier(0.4, 0, 0.2, 1)',
                        padding: '4px 0'
                      }}>
                      {tests.map((test, idx) => (
                        <div key={idx} style={{
                          minWidth: `${cardWidth}px`,
                          background: 'white',
                          border: '1px solid #E4E7EB',
                          borderRadius: '12px',
                          boxShadow: '0 2px 8px rgba(0, 0, 0, 0.06)',
                          display: 'flex',
                          flexDirection: 'column',
                          height: '700px'
                        }}>
                          {/* Test Header */}
                          <div style={{
                            padding: '18px 22px',
                            background: '#FAFBFC',
                            borderBottom: '1px solid #E4E7EB',
                            flexShrink: 0,
                            borderRadius: '12px 12px 0 0'
                          }}>
                            <div style={{
                              display: 'flex',
                              alignItems: 'center',
                              justifyContent: 'space-between',
                              marginBottom: '10px'
                            }}>
                              <div style={{ display: 'flex', alignItems: 'center', gap: '10px', flex: 1 }}>
                                <span style={{ fontSize: '18px' }}>
                                  {getDimensionIcon(test.dimension)}
                                </span>
                                <div>
                                  <div style={{
                                    fontSize: '11px',
                                    fontWeight: '600',
                                    color: '#6B7280',
                                    textTransform: 'uppercase',
                                    letterSpacing: '0.5px'
                                  }}>
                                    {test.dimension || 'TEST'}
                                  </div>
                                  <div style={{ fontSize: '14px', fontWeight: '600', color: '#1A1F36', marginTop: '2px' }}>
                                    {test.agentName}
                                  </div>
                                </div>
                              </div>
                              <div style={{
                                padding: '5px 12px',
                                borderRadius: '6px',
                                fontSize: '11px',
                                fontWeight: '600',
                                letterSpacing: '0.3px',
                                background: test.passed ? '#D1FAE5' : '#FEE2E2',
                                color: test.passed ? '#059669' : '#DC2626'
                              }}>
                                {test.passed ? 'PASSED' : 'FAILED'}
                              </div>
                            </div>
                            <div style={{
                              fontSize: '11px',
                              color: '#6B7280',
                              display: 'flex',
                              alignItems: 'center',
                              gap: '8px'
                            }}>
                              <span>Passing: <strong>{test.evaluation?.reasoning?.passedPercentage?.toFixed(0) || 0}%</strong> / {test.evaluation?.reasoning?.passingThreshold || 100}% required</span>
                              {test.isMultiRun && (
                                <span>â€¢ {test.passedRuns || 0}/{test.totalRuns || 3} runs</span>
                              )}
                            </div>
                          </div>
                          
                          {/* Test Content */}
                          <div style={{
                            padding: '20px 24px',
                            flex: 1,
                            overflow: 'hidden',
                            display: 'flex',
                            flexDirection: 'column'
                          }}>
                            {/* Input/Output Section */}
                            <div style={{
                              display: 'grid',
                              gridTemplateColumns: '1fr 1fr',
                              gap: '16px',
                              marginBottom: '20px',
                              flexShrink: 0
                            }}>
                              <div style={{
                                background: '#F9FAFB',
                                border: '1px solid #E4E7EB',
                                borderRadius: '6px',
                                padding: '12px',
                                height: '100px',
                                display: 'flex',
                                flexDirection: 'column'
                              }}>
                                <div style={{
                                  fontSize: '10px',
                                  fontWeight: '600',
                                  color: '#6B7280',
                                  textTransform: 'uppercase',
                                  letterSpacing: '0.5px',
                                  marginBottom: '8px'
                                }}>
                                  Test Input
                                </div>
                                <div style={{
                                  fontSize: '11px',
                                  color: '#374151',
                                  lineHeight: '1.4',
                                  fontFamily: "'SF Mono', 'Monaco', monospace",
                                  overflow: 'auto',
                                  flex: 1
                                }}>
                                  {test.input || 'N/A'}
                                </div>
                              </div>
                              
                              <div style={{
                                background: '#F9FAFB',
                                border: '1px solid #E4E7EB',
                                borderRadius: '6px',
                                padding: '12px',
                                height: '100px',
                                display: 'flex',
                                flexDirection: 'column'
                              }}>
                                <div style={{
                                  fontSize: '10px',
                                  fontWeight: '600',
                                  color: '#6B7280',
                                  textTransform: 'uppercase',
                                  letterSpacing: '0.5px',
                                  marginBottom: '8px'
                                }}>
                                  {test.isTeam ? 'Team Response' : 'Agent Response'}
                                </div>
                                <div style={{
                                  fontSize: '11px',
                                  color: '#374151',
                                  lineHeight: '1.4',
                                  fontFamily: "'SF Mono', 'Monaco', monospace",
                                  overflow: 'auto',
                                  flex: 1
                                }}>
                                  {test.output || 'N/A'}
                                </div>
                              </div>
                            </div>
                            
                            {/* Criteria Section */}
                            <div style={{
                              flex: 1,
                              display: 'flex',
                              flexDirection: 'column',
                              overflow: 'hidden'
                            }}>
                              <div style={{
                                display: 'flex',
                                justifyContent: 'space-between',
                                alignItems: 'center',
                                marginBottom: '16px',
                                paddingBottom: '12px',
                                borderBottom: '1px solid #F0F2F5',
                                flexShrink: 0
                              }}>
                                <div style={{ fontSize: '13px', fontWeight: '600', color: '#1A1F36' }}>
                                  Evaluation Criteria
                                </div>
                                <div style={{
                                  display: 'flex',
                                  alignItems: 'center',
                                  gap: '6px',
                                  fontSize: '12px'
                                }}>
                                  <span style={{ color: '#6B7280', fontWeight: '400' }}>Score:</span>
                                  <span style={{ 
                                    fontWeight: '600', 
                                    color: test.passed ? '#059669' : '#DC2626'
                                  }}>
                                    {test.evaluation?.reasoning?.passedPercentage?.toFixed(0) || '0'}%
                                  </span>
                                </div>
                              </div>
                              
                              {getCriteria(test).length > 0 && (() => {
                                const testCriteria = getCriteria(test);
                                const testCriteriaIndex = getCurrentCriteriaIndex(idx);
                                
                                return (
                                  <div style={{ 
                                    flex: 1, 
                                    position: 'relative', 
                                    overflow: 'visible',
                                    display: 'flex',
                                    flexDirection: 'column'
                                  }}>
                                    <div style={{ 
                                      overflow: 'hidden', 
                                      margin: '0 -10px', 
                                      padding: '0 10px',
                                      flex: 1
                                    }}>
                                      <div style={{
                                        display: 'flex',
                                        gap: '12px',
                                        transform: `translateX(-${testCriteriaIndex * (criteriaCardWidth - 60 + 12)}px)`,
                                        transition: 'transform 0.4s ease'
                                      }}>
                                        {testCriteria.map((criterion, cIdx) => (
                                        <div key={cIdx} style={{ minWidth: `${criteriaCardWidth - 60}px` }}>
                                          <div style={{
                                            background: criterion.met ? '#F0FDF4' : '#FEF2F2',
                                            border: `1px solid ${criterion.met ? '#BBF7D0' : '#FECACA'}`,
                                            borderRadius: '8px',
                                            padding: '14px',
                                            height: '280px',
                                            display: 'flex',
                                            flexDirection: 'column'
                                          }}>
                                            <div style={{
                                              display: 'flex',
                                              justifyContent: 'space-between',
                                              alignItems: 'flex-start',
                                              marginBottom: '10px'
                                            }}>
                                              <div style={{ flex: 1, paddingRight: '10px' }}>
                                                <div style={{ fontSize: '9px', color: '#9CA3AF', marginBottom: '4px' }}>
                                                  CRITERION {cIdx + 1} OF {getCriteria(test).length}
                                                </div>
                                                <div style={{
                                                  fontSize: '13px',
                                                  color: '#1A1F36',
                                                  fontWeight: '500',
                                                  lineHeight: '1.3',
                                                  marginBottom: '6px'
                                                }}>
                                                  {criterion.criterion}
                                                </div>
                                                <div style={{
                                                  fontSize: '10px',
                                                  color: '#3B82F6',
                                                  fontWeight: '500'
                                                }}>
                                                  Strictness: {criterion.strictness || criterion.evaluation_strictness || 85}/100
                                                </div>
                                              </div>
                                              <div style={{
                                                display: 'flex',
                                                flexDirection: 'column',
                                                alignItems: 'flex-end',
                                                gap: '2px'
                                              }}>
                                                <div style={{
                                                  fontSize: '18px',
                                                  fontWeight: '600',
                                                  color: getScoreColor(criterion.score * 100)
                                                }}>
                                                  {(criterion.score * 100).toFixed(0)}%
                                                </div>
                                                <div style={{
                                                  padding: '2px 6px',
                                                  borderRadius: '4px',
                                                  fontSize: '9px',
                                                  fontWeight: '600',
                                                  textTransform: 'uppercase',
                                                  background: criterion.met ? '#D1FAE5' : '#FEE2E2',
                                                  color: criterion.met ? '#059669' : '#DC2626'
                                                }}>
                                                  {criterion.met ? 'PASS' : 'FAIL'}
                                                </div>
                                              </div>
                                            </div>
                                            
                                            <div style={{
                                              margin: '0 0 10px 0',
                                              background: 'rgba(0, 0, 0, 0.05)',
                                              borderRadius: '3px',
                                              height: '4px',
                                              position: 'relative'
                                            }}>
                                              <div style={{
                                                height: '100%',
                                                background: getScoreBarClass(criterion.score * 100),
                                                width: `${criterion.score * 100}%`,
                                                borderRadius: '3px'
                                              }} />
                                              <div style={{
                                                position: 'absolute',
                                                top: 0,
                                                left: `${(criterion.strictness || criterion.evaluation_strictness || 85)}%`,
                                                height: '100%',
                                                width: '1px',
                                                background: '#1A1F36',
                                                opacity: 0.4
                                              }} />
                                            </div>
                                            
                                            <div style={{ flex: 1, overflow: 'auto' }}>
                                              {criterion.evidence && (
                                                <div style={{ marginBottom: '8px' }}>
                                                  <div style={{ fontSize: '9px', color: '#6B7280', fontWeight: '600', marginBottom: '3px' }}>
                                                    EVIDENCE
                                                  </div>
                                                  <div style={{
                                                    fontSize: '11px',
                                                    color: '#374151',
                                                    lineHeight: '1.4'
                                                  }}>
                                                    {criterion.evidence}
                                                  </div>
                                                </div>
                                              )}
                                              
                                              {criterion.reasoning && criterion.reasoning !== criterion.evidence && (
                                                <div>
                                                  <div style={{ fontSize: '9px', color: '#6B7280', fontWeight: '600', marginBottom: '3px' }}>
                                                    REASONING
                                                  </div>
                                                  <div style={{
                                                    fontSize: '11px',
                                                    color: '#374151',
                                                    lineHeight: '1.4',
                                                    fontStyle: 'italic'
                                                  }}>
                                                    {criterion.reasoning}
                                                  </div>
                                                </div>
                                              )}
                                            </div>
                                          </div>
                                        </div>
                                      ))}
                                    </div>
                                  </div>
                                  
                                  <div style={{
                                    display: 'flex',
                                    justifyContent: 'center',
                                    alignItems: 'center',
                                    gap: '16px',
                                    marginTop: '16px'
                                  }}>
                                    <button
                                      onClick={() => {
                                        const newIdx = Math.max(0, testCriteriaIndex - 1);
                                        setCurrentCriteriaIndex(idx, newIdx);
                                      }}
                                      disabled={testCriteriaIndex === 0}
                                      style={{
                                        width: '32px',
                                        height: '32px',
                                        borderRadius: '50%',
                                        background: 'white',
                                        border: '1px solid #E4E7EB',
                                        boxShadow: '0 1px 3px rgba(0, 0, 0, 0.1)',
                                        display: 'flex',
                                        alignItems: 'center',
                                        justifyContent: 'center',
                                        cursor: testCriteriaIndex === 0 ? 'not-allowed' : 'pointer',
                                        opacity: testCriteriaIndex === 0 ? 0.3 : 1,
                                        transition: 'all 0.2s ease'
                                      }}
                                      onMouseEnter={(e) => {
                                        if (testCriteriaIndex !== 0) {
                                          e.currentTarget.style.boxShadow = '0 2px 6px rgba(0, 0, 0, 0.15)';
                                          e.currentTarget.style.transform = 'scale(1.05)';
                                        }
                                      }}
                                      onMouseLeave={(e) => {
                                        e.currentTarget.style.boxShadow = '0 1px 3px rgba(0, 0, 0, 0.1)';
                                        e.currentTarget.style.transform = 'scale(1)';
                                      }}
                                    >
                                      <svg style={{ width: '14px', height: '14px' }} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2.5">
                                        <polyline points="15 18 9 12 15 6"/>
                                      </svg>
                                    </button>
                                    
                                    <div style={{
                                      fontSize: '11px',
                                      color: '#6B7280',
                                      fontWeight: '500',
                                      minWidth: '80px',
                                      textAlign: 'center'
                                    }}>
                                      {testCriteriaIndex + 1} of {testCriteria.length}
                                    </div>
                                    
                                    <button
                                      onClick={() => {
                                        const newIdx = Math.min(testCriteria.length - 1, testCriteriaIndex + 1);
                                        setCurrentCriteriaIndex(idx, newIdx);
                                      }}
                                      disabled={testCriteriaIndex === testCriteria.length - 1}
                                      style={{
                                        width: '32px',
                                        height: '32px',
                                        borderRadius: '50%',
                                        background: 'white',
                                        border: '1px solid #E4E7EB',
                                        boxShadow: '0 1px 3px rgba(0, 0, 0, 0.1)',
                                        display: 'flex',
                                        alignItems: 'center',
                                        justifyContent: 'center',
                                        cursor: testCriteriaIndex === testCriteria.length - 1 ? 'not-allowed' : 'pointer',
                                        opacity: testCriteriaIndex === testCriteria.length - 1 ? 0.3 : 1,
                                        transition: 'all 0.2s ease'
                                      }}
                                      onMouseEnter={(e) => {
                                        if (testCriteriaIndex !== testCriteria.length - 1) {
                                          e.currentTarget.style.boxShadow = '0 2px 6px rgba(0, 0, 0, 0.15)';
                                          e.currentTarget.style.transform = 'scale(1.05)';
                                        }
                                      }}
                                      onMouseLeave={(e) => {
                                        e.currentTarget.style.boxShadow = '0 1px 3px rgba(0, 0, 0, 0.1)';
                                        e.currentTarget.style.transform = 'scale(1)';
                                      }}
                                    >
                                      <svg style={{ width: '14px', height: '14px' }} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2.5">
                                        <polyline points="9 18 15 12 9 6"/>
                                      </svg>
                                    </button>
                                  </div>
                                  
                                  <div style={{
                                    display: 'flex',
                                    justifyContent: 'center',
                                    gap: '6px',
                                    marginTop: '8px',
                                    flexShrink: 0
                                  }}>
                                    {testCriteria.map((_, cIdx) => (
                                      <span
                                        key={cIdx}
                                        onClick={() => setCurrentCriteriaIndex(idx, cIdx)}
                                        style={{
                                          width: cIdx === testCriteriaIndex ? '16px' : '6px',
                                          height: '6px',
                                          borderRadius: cIdx === testCriteriaIndex ? '3px' : '50%',
                                          background: cIdx === testCriteriaIndex ? '#6B7280' : '#E5E7EB',
                                          transition: 'all 0.3s ease',
                                          cursor: 'pointer'
                                        }}
                                      />
                                    ))}
                                  </div>
                                  </div>
                                );
                              })()}
                              
                              {getCriteria(test).length === 0 && (
                                <div style={{ 
                                  textAlign: 'center', 
                                  padding: '40px 20px', 
                                  color: '#9CA3AF',
                                  fontSize: '13px'
                                }}>
                                  No evaluation criteria available
                                </div>
                              )}
                            </div>
                          </div>
                          
                          {/* Footer */}
                          <div style={{
                            padding: '16px 24px',
                            background: '#F9FAFB',
                            borderTop: '1px solid #E4E7EB',
                            display: 'flex',
                            justifyContent: 'space-between',
                            alignItems: 'center',
                            flexWrap: 'wrap',
                            gap: '12px',
                            borderRadius: '0 0 12px 12px',
                            flexShrink: 0
                          }}>
                            <div style={{ display: 'flex', alignItems: 'center', gap: '6px', fontSize: '11px', color: '#6B7280' }}>
                              <span>Test ID:</span>
                              <span style={{ fontWeight: '600', color: '#374151' }}>{test.id || 'N/A'}</span>
                            </div>
                            <div style={{ display: 'flex', alignItems: 'center', gap: '6px', fontSize: '11px', color: '#6B7280' }}>
                              <span>Latency:</span>
                              <span style={{ fontWeight: '600', color: '#374151' }}>
                                {test.latencyMs ? `${Math.round(test.latencyMs)}ms` : 'N/A'}
                              </span>
                            </div>
                            <div style={{ display: 'flex', alignItems: 'center', gap: '6px', fontSize: '11px', color: '#6B7280' }}>
                              <span>Agent:</span>
                              <span style={{ fontWeight: '600', color: '#374151' }}>{test.agentName || 'Unknown'}</span>
                            </div>
                            {test.isMultiRun && (
                              <div style={{ display: 'flex', alignItems: 'center', gap: '6px', fontSize: '11px', color: '#6B7280' }}>
                                <span>Multi-Run:</span>
                                <span style={{ fontWeight: '600', color: '#374151' }}>
                                  {test.passedRuns || 0}/{test.totalRuns || 3} passed
                                </span>
                              </div>
                            )}
                          </div>
                        </div>
                      ))}
                    </div>
                  </div>
                </div>
                
                {/* Navigation Buttons */}
                <div style={{
                  position: 'absolute',
                  top: '50%',
                  transform: 'translateY(-50%)',
                  width: '100%',
                  display: 'flex',
                  justifyContent: 'space-between',
                  pointerEvents: 'none',
                  zIndex: 10
                }}>
                  <button
                    onClick={() => navigateTest(-1)}
                    disabled={currentTestIndex === 0}
                    style={{
                      width: '40px',
                      height: '40px',
                      borderRadius: '50%',
                      background: 'white',
                      border: '1px solid #E4E7EB',
                      boxShadow: '0 2px 8px rgba(0, 0, 0, 0.1)',
                      display: 'flex',
                      alignItems: 'center',
                      justifyContent: 'center',
                      cursor: currentTestIndex === 0 ? 'not-allowed' : 'pointer',
                      opacity: currentTestIndex === 0 ? 0.3 : 1,
                      pointerEvents: 'all'
                    }}
                  >
                    <ChevronLeft />
                  </button>
                  <button
                    onClick={() => navigateTest(1)}
                    disabled={currentTestIndex === tests.length - 1}
                    style={{
                      width: '40px',
                      height: '40px',
                      borderRadius: '50%',
                      background: 'white',
                      border: '1px solid #E4E7EB',
                      boxShadow: '0 2px 8px rgba(0, 0, 0, 0.1)',
                      display: 'flex',
                      alignItems: 'center',
                      justifyContent: 'center',
                      cursor: currentTestIndex === tests.length - 1 ? 'not-allowed' : 'pointer',
                      opacity: currentTestIndex === tests.length - 1 ? 0.3 : 1,
                      pointerEvents: 'all'
                    }}
                  >
                    <ChevronRight />
                  </button>
                </div>
              </div>
              
              {/* Pagination Dots */}
              <div style={{
                display: 'flex',
                justifyContent: 'center',
                gap: '8px',
                marginTop: '24px'
              }}>
                {tests.map((_, index) => (
                  <span
                    key={index}
                    onClick={() => goToTest(index)}
                    style={{
                      width: index === currentTestIndex ? '24px' : '8px',
                      height: '8px',
                      borderRadius: index === currentTestIndex ? '4px' : '50%',
                      background: index === currentTestIndex ? '#6B7280' : '#E5E7EB',
                      transition: 'all 0.3s ease',
                      cursor: 'pointer'
                    }}
                  />
                ))}
              </div>
              </div>
            </>
          );
        };
        
        // Data loading and initialization
        const EMBEDDED_REPORT_DATA = "REPORT_DATA_PLACEHOLDER";
        
        // React automatically escapes all JSX content, providing XSS protection
        // No manual decoding needed - React handles display safely
        
        function initializeReport() {
          try {
            const reportData = EMBEDDED_REPORT_DATA;
            
            // Update metadata
            if (reportData.metadata) {
              const timestampEl = document.getElementById('timestamp');
              const projectNameEl = document.getElementById('project-name');
              
              if (timestampEl && reportData.metadata.timestamp) {
                timestampEl.textContent = new Date(reportData.metadata.timestamp).toLocaleString();
              }
              
              if (projectNameEl && reportData.metadata.project) {
                projectNameEl.textContent = reportData.metadata.project;
              }
            }
            
            // Create summary cards
            if (reportData.summary) {
              const summaryContainer = document.getElementById('summary-container');
              if (summaryContainer) {
                const summary = reportData.summary;
                const successRate = summary.totalTests > 0 ? 
                  Math.round((summary.passed / summary.totalTests) * 100) : 0;
                
                summaryContainer.innerHTML = `
                  <div class="summary-cards">
                    <div class="summary-card">
                      <div class="summary-card-label">Total Tests</div>
                      <div class="summary-card-value">${summary.totalTests || 0}</div>
                    </div>
                    <div class="summary-card passed">
                      <div class="summary-card-label">Passed</div>
                      <div class="summary-card-value">${summary.passed || 0}</div>
                    </div>
                    <div class="summary-card failed">
                      <div class="summary-card-label">Failed</div>
                      <div class="summary-card-value">${summary.failed || 0}</div>
                    </div>
                    <div class="summary-card">
                      <div class="summary-card-label">Success Rate</div>
                      <div class="summary-card-value">${successRate}%</div>
                    </div>
                  </div>
                `;
              }
            }
            
            // Collect all tests from agents and teams
            const allTests = [];
            
            if (reportData.agents) {
              for (const [agentName, agent] of Object.entries(reportData.agents)) {
                if (agent.dimensions) {
                  for (const [dimensionName, dimension] of Object.entries(agent.dimensions)) {
                    if (dimension.tests) {
                      dimension.tests.forEach(test => {
                        allTests.push({
                          ...test,
                          agentName,
                          dimension: dimensionName
                        });
                      });
                    }
                  }
                }
              }
            }
            
            if (reportData.teams) {
              for (const [teamName, team] of Object.entries(reportData.teams)) {
                if (team.dimensions) {
                  for (const [dimensionName, dimension] of Object.entries(team.dimensions)) {
                    if (dimension.tests) {
                      dimension.tests.forEach(test => {
                        allTests.push({
                          ...test,
                          agentName: teamName,
                          dimension: dimensionName,
                          isTeam: true
                        });
                      });
                    }
                  }
                }
              }
            }
            
            // Render carousel if we have tests
            // React automatically escapes all JSX content for XSS protection
            if (allTests.length > 0) {
              ReactDOM.render(
                React.createElement(TestCarousel, { tests: allTests }),
                document.getElementById('root')
              );
            } else {
              document.getElementById('root').innerHTML = `
                <div style="text-align: center; padding: 40px; color: #6B7280;">
                  No test results available
                </div>
              `;
            }
          } catch (error) {
            console.error('Error loading report:', error);
            document.getElementById('root').innerHTML = `
              <div style="text-align: center; padding: 40px; color: #DC2626;">
                Error loading report: ${error.message}
              </div>
            `;
          }
        }
        
        // Initialize when DOM is ready
        if (document.readyState === 'loading') {
          document.addEventListener('DOMContentLoaded', initializeReport);
        } else {
          initializeReport();
        }
    </script>
</body>
</html>
